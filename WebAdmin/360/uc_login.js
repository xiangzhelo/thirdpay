(function(e){"use strict";var t=e.$,n='<div class="quc-mod-sign-in"><div class="quc-tip-wrapper"><p class="quc-tip"></p></div><div class="quc-main"></div><div class="quc-footer"><a class="quc-link quc-link-grey quc-link-normal-sign-in" href="#">\u4f7f\u7528\u5176\u4ed6\u5e10\u53f7\u767b\u5f55</a><a class="quc-link quc-link-grey quc-link-quick-sign-in" href="#">\u8fd4\u56de\u5feb\u901f\u767b\u5f55</a><a class="quc-link quc-link-grey quc-link-sign-up" href="#">\u6ce8\u518c\u65b0\u5e10\u53f7</a><a class="quc-link quc-link-about quc-link-about-normal" href="'+QHDomain.i360+'/findpwd/" target="_blank">\u5fd8\u8bb0\u5bc6\u7801\uff1f</a>'+'<a class="quc-link quc-link-about quc-link-about-mobile" href="'+QHDomain.i360+'/help/smscode" target="_blank">\u6821\u9a8c\u7801\u5e38\u89c1\u95ee\u9898</a>'+'<a class="quc-link quc-link-about quc-link-about-qrcode" href="#">\u4ec0\u4e48\u662f\u4e8c\u7ef4\u7801\u767b\u5f55\uff1f</a>'+'<a class="quc-link quc-link-about quc-link-about-onekey" href="#">\u4ec0\u4e48\u662f\u4e00\u952e\u767b\u5f55\uff1f</a>'+"</div>"+"</div>",r={normal:'<form class="quc-form"><div class="quc-ipbox"><p class="quc-field quc-field-account quc-input-long botborder"><label class="quc-label">\u5e10\u53f7\uff1a</label><span class="quc-input-bg quc-input-bg-focus"><input class="quc-input quc-input-account" type="text" name="account" placeholder="\u624b\u673a\u53f7/\u7528\u6237\u540d/\u90ae\u7bb1" autocomplete="off" ></span></p><p class="quc-field quc-field-password quc-input-long"><label class="quc-label">\u5bc6\u7801\uff1a</label><span class="quc-input-bg"><input class="quc-input quc-input-password" type="password" name="password" maxlength="20" placeholder="\u8f93\u5165\u60a8\u7684\u5bc6\u7801\u6216\u52a8\u6001\u5bc6\u7801"></span></p></div><p class="quc-field quc-field-captcha quc-input-short quc-clearfix"><span class="quc-ipbox fl"><label class="quc-label">\u9a8c\u8bc1\u7801\uff1a</label><span class="quc-input-bg quc-checkcode"><input class="quc-input quc-input-captcha" type="text" name="phrase" maxlength="7" autocomplete="off" placeholder="\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801"></span></span><img class="quc-captcha-img quc-captcha-change" alt="\u9a8c\u8bc1\u7801" title="\u70b9\u51fb\u66f4\u6362" tabindex="99" src="#"><a class="quc-link quc-captcha-change-link quc-captcha-change" href="#">\u6362\u4e00\u5f20</a></p><p class="quc-field quc-field-keep-alive"><a class="quc-link quc-link-about quc-link-about-normal quc-findPwd" href="'+QHDomain.i360+'/findpwd/" target="_blank">\u5fd8\u8bb0\u5bc6\u7801\uff1f</a>'+'<label><input class="quc-checkbox quc-checkbox-keep-alive" type="checkbox" name="iskeepalive" checked="checked">\u4e0b\u6b21\u81ea\u52a8\u767b\u5f55</label>'+"</p>"+'<p class="quc-field quc-field-submit"><input type="submit" value="\u767b\u5f55" class="quc-submit quc-button quc-button-sign-in"> </p>'+'<p class="quc-field quc-field-third-part">'+"<span>\u5176\u4ed6\u5e10\u53f7\u767b\u5f55\uff1a</span>"+'<span class="quc-third-part"></span>'+"</p>"+"</form>",mobile:'<form class="quc-form"><p class="quc-field quc-field-mobile quc-input-middle"><label class="quc-label">\u624b\u673a\u53f7</label><span class="quc-input-bg"><input type="tel" name="mobile" class="quc-input quc-input-mobile" maxlength="11" placeholder="\u8bf7\u8f93\u5165\u60a8\u7684\u624b\u673a\u53f7" /></span><a class="quc-button quc-button-blue quc-button-get-sms-token" href="#">\u514d\u8d39\u83b7\u53d6\u6821\u9a8c\u7801</a></p><p class="quc-field quc-field-sms-token quc-input-long"><label class="quc-label">\u6821\u9a8c\u7801</label><span class="quc-input-bg"><input class="quc-input quc-input-sms-token" type="tel" name="smscode" autocomplete="off" maxlength="6" placeholder="\u8bf7\u8f93\u5165\u60a8\u6536\u5230\u7684\u77ed\u4fe1\u6821\u9a8c\u7801" /></span></p><p class="quc-field quc-field-keep-alive"><label><input class="quc-checkbox quc-checkbox-keep-alive" type="checkbox" name="iskeepalive" checked="checked">\u4e0b\u6b21\u81ea\u52a8\u767b\u5f55</label></p><p class="quc-field quc-field-submit"><input class="quc-submit quc-button quc-button-sign-in" type="submit" value="\u767b\u5f55" /> </p></form>',qrcode:'<p class="quc-title"></p><div class="quc-qrcode-wrapper"><img class="quc-qrcode" src="http://login.360.cn/?o=sso&m=getLoginQrcode&s=3" style="display: none;"><div class="quc-qrcode-tip"><i style="cursor: pointer;"></i><span style="cursor: pointer;">\u4e8c\u7ef4\u7801\u52a0\u8f7d\u5931\u8d25<br>\u70b9\u51fb\u91cd\u65b0\u52a0\u8f7d</span></div></div><p class="quc-tips">\u8bf7\u4f7f\u7528 <a href="/security/accountguard" target="_blank" class="orange"><em style="text-decoration: underline;">360\u5e10\u53f7\u536b\u58eb</em></a> \u7684 <em class="orange">\u4e8c\u7ef4\u7801</em> \u529f\u80fd\u626b\u63cf\u4e8c\u7ef4\u7801\u56fe\u7247</p><p class="quc-field quc-field-cancel"><input type="submit" value="\u8fd4 \u56de" class="quc-button quc-cancel"> </p>',quick:'<div class="quc-loading"></div><iframe class="quc-sign-in-iframe" src="about:blank" frameborder="0" scrolling="no" allowtransparency></iframe>'},i={sina:'<a href="#" class="quc-third-part-icon quc-third-part-icon-sina" title="\u65b0\u6d6a\u5fae\u535a\u767b\u5f55"></a>',renren:'<a href="#" class="quc-third-part-icon quc-third-part-icon-renren" title="\u4eba\u4eba\u767b\u5f55"></a>',fetion:'<a href="#" class="quc-third-part-icon quc-third-part-icon-fetion" title="\u98de\u4fe1\u767b\u5f55"></a>',telecom:'<a href="#" class="quc-third-part-icon quc-third-part-icon-telecom" title="\u5929\u7ffc\u767b\u5f55"></a>'},s={quick:"\u5feb\u901f\u767b\u5f55",normal:"\u666e\u901a\u767b\u5f55",mobile:"\u77ed\u4fe1\u767b\u5f55",qrcode:"\u4e8c\u7ef4\u7801\u767b\u5f55",onekey:"\u4e00\u952e\u767b\u5f55"},o={},u={init:function(e){o={},this.model=e,this.$el=t(n),this.initForm(),this.initErrorTip(),this.initFooterLink(),this.initThirdPartSignIn(),this.initModelEvent(),this.initSmsToken(),this.initQrCode(),this.initCaptcha()},reset:function(){o={},this.initQuickSignIn(),this.signInType=null,this.$el.find(".quc-tip").html("")},changeType:function(e){var n=this,i=n.model,s=o[e],u;n.$el.attr("class","quc-mod-sign-in quc-mod-"+e+"-sign-in");if(!s){s=o[e]=t(r[e]);var a=this.model.get("saveAccount");a&&e==a.type&&(u=s.find(".quc-input-account,.quc-input-mobile").val(a.account))}n.$el.find(".quc-main").empty().append(s),i.trigger("DOMUpdated",this.$el),n.signInType=e;var f=n.getTitle();n.$nav.replaceWith(f),n.$nav=f,s.find(".quc-input").each(function(e,n){var r=t(n);if(r.val()==0)return i.one("changeType afterShow",function(){u&&u.focus(),r.focus()}),!1}),i.trigger("changeType",e),i.trigger("changeType:"+e)},initQuickSignIn:function(){if(!this.model.isQuickSignInAvailable())return;var e=t(r.quick);e.attr("src",this.model.getQuickSignInUrl()),o.quick=e},initForm:function(){var n=this;n.model.on("changeType",function(r,i){if(i=="quick")return;n.$el.find(".quc-checkbox-keep-alive").prop("checked",n.model.get("isKeepAlive")).change(function(){n.model.set("isKeepAlive",t(this).prop("checked"))}),n.$el.find(".quc-input").focus(function(){t(this).parent().addClass("quc-input-bg-focus"),t.trim(t(this).val())&&n.$el.find(".quc-tip").html("")}).blur(function(){t(this).parent().removeClass("quc-input-bg-focus")}),n.$el.find(".quc-form").submit(function(e){e.preventDefault();var r=t(this),s=n.model,o=r.find(".quc-button-sign-in");o.prop("disabled",!0).addClass("quc-button-signing-in"),s.one("invalid",function(){o.prop("disabled",!1).removeClass("quc-button-signing-in")}),i=="normal"?(s.set("username",t.trim(r.find(".quc-input-account").val())),s.set("password",r.find(".quc-input-password").val()),s.set("captcha",t.trim(r.find(".quc-input-captcha").val())),s.set("isNeedCheckCaptcha",n.$el.find(".quc-field-captcha:visible")[0]?!0:!1)):i=="mobile"&&(s.set("mobile",t.trim(r.find(".quc-input-mobile").val())),s.set("smsToken",t.trim(r.find(".quc-input-sms-token").val()))),n.model.submit(i)}),e.utils.emailHint(n.$el.find(".quc-input-account"),"account")})},initFooterLink:function(){var e=this,t=this.$el.find(".quc-footer");t.find(".quc-link-sign-up").click(function(t){t.preventDefault(),e.onSignUp()}).end().find(".quc-link-quick-sign-in").click(function(t){t.preventDefault(),e.changeType("quick")}).end().find(".quc-link-normal-sign-in").click(function(t){t.preventDefault(),e.changeType(e.model.getSignInTypes()[0])}),e.model.on("changeType",function(n,r){r=="quick"?e.model.getSignInTypes().length==0&&t.hide():e.model.isQuickSignInAvailable()||t.find(".quc-link-quick-sign-in").hide()})},initQrCode:function(){function a(){t.model.listenQrcodeLogin().done(function(){clearInterval(s)})}function f(){if(o.parents("body").length==0)return;u.show().find("span").html(i),o.hide(),o.off("load").on("load",function(){o.show(),u.hide(),n=(new Date).getTime(),setTimeout(function(){o.trigger("error"),clearInterval(s)},r)}),o.off("error").on("error",function(){u.find("span").html("\u4e8c\u7ef4\u7801\u5df2\u8fc7\u671f<br/>\u70b9\u51fb\u91cd\u65b0\u52a0\u8f7d"),u.find("i,span").css("cursor","pointer"),u.one("click",function(){i="\u4e8c\u7ef4\u7801\u52a0\u8f7d\u4e2d...",u.find("i,span").css("cursor","auto"),f(),s=setInterval(a,2e3)}).show()}),o.attr("src",e.getConfig("protocol")+"://"+QHDomain.login_http.split("//")[1]+"/?o=sso&m=getLoginQrcode&s=3&t="+Math.random()),i="\u4e8c\u7ef4\u7801\u5df2\u8fc7\u671f\uff0c<br>\u81ea\u52a8\u5237\u65b0\u4e2d..."}var t=this,n=0,r=e.getConfig("signIn.qrCodeTTL",120)*1e3,i="\u4e8c\u7ef4\u7801\u52a0\u8f7d\u4e2d...",s=0,o,u;t.model.on("changeType:qrcode",function(){o=t.$el.find(".quc-qrcode"),u=t.$el.find(".quc-qrcode-tip"),(new Date).getTime()-n>=r?f():u.hide(),s=setInterval(a,2e3),t.model.on("changeType",function(e,t){t!="qrcode"&&clearInterval(s)})})},initSmsToken:function(){var t=this,n,r,i,s=e.utils.getTimer("sign_in");s.on("timer_start",function(e,t){r.addClass("quc-button-disabled"),r.html(t+"\u79d2\u540e\u53ef\u91cd\u65b0\u83b7\u53d6")}),s.on("timer_tick",function(e,t){r.html(t+"\u79d2\u540e\u53ef\u91cd\u65b0\u83b7\u53d6")}),s.on("timer_stop",function(){r.html("\u91cd\u65b0\u83b7\u53d6\u6821\u9a8c\u7801"),r.removeClass("quc-button-disabled")});var o=function(e){e.preventDefault();if(r.hasClass("quc-button-disabled"))return;t.model.set("mobile",n.val()),r.html("\u53d1\u9001\u4e2d..."),r.addClass("quc-button-disabled"),t.model.sendSmsToken().done(function(){var e=t.$el.find(".quc-tip");e.removeClass("quc-tip-error").addClass("quc-tip-success").html("\u53d1\u9001\u6210\u529f").show(),i.find(".quc-input").one("change",function(){e.removeClass("quc-tip-success").html(e.attr("data-default-tip"))}),s.start()}).fail(function(e){r.html("\u514d\u8d39\u83b7\u53d6\u6821\u9a8c\u7801"),r.removeClass("quc-button-disabled"),e.field=t.$el.find(".quc-field-mobile"),t.model.trigger("invalid",e)})};this.model.on("changeType:mobile",function(){i=t.$el.find(".quc-field-mobile"),n=i.find(".quc-input-mobile"),r=t.$el.find(".quc-button-get-sms-token"),r.off("click",o).on("click",o),s.isRunning()&&s.resume()})},initThirdPartSignIn:function(){var e=this;e.model.on("changeType:normal",function(){var n=e.model.getThirdPartProviders();n=t.grep(n,function(t){return i[t]?!0:(e.model.trigger("warn","\u9519\u8bef\u7684\u7b2c\u4e09\u65b9\u767b\u5f55\u7c7b\u578b\uff1a"+t),!1)});if(n.length>0){var r=t("<span>").addClass("quc-third-part");t.each(n,function(n,s){t(i[s]).click(function(t){t.preventDefault(),e.model.thirdPartSignIn(s)}).appendTo(r)}),e.$el.find(".quc-third-part").replaceWith(r)}else e.$el.find(".quc-field-third-part").hide()})},initModelEvent:function(){var e=this;this.model.on("show",function(t,n){e.show(n&&n.wrapper)}).on("hide",function(){e.hide()})},initErrorTip:function(){var t=this;t.model.on("invalid",function(n,r){var i=t.$el.find(".quc-tip");if(r.signInType&&t.signInType!=r.signInType)return;var s=t.$el.find(".quc-input-"+e.utils.getErrorType(r));e.utils.getErrorType(r)=="password"&&e.utils.selectText(s),i.removeClass("quc-tip-success").addClass("quc-tip-error").html(r.errmsg),t.model.one("changeType",function(){i.html("")})})},onSignUp:function(){this.model.signUp()},initCaptcha:function(){var n=this,r,i=!1,s=function(e){n.model.getCaptchaUrl("login").then(function(t){r.find(".quc-captcha-img").attr("src",t);var n=r.find(".quc-input-captcha").val("");e&&n.focus()})},o=function(t,o){var u=e.utils.getErrorType(o)=="captcha";i&&o.fromServer&&n.signInType==o.signInType?s(u):u&&(r.show(),i||s(!0),i=!0)};n.model.on("changeType",function(e,u){n.model.off("invalid",o);if(u!="normal")return;r=n.$el.find(".quc-field-captcha"),n.$el.find(".quc-input-account").blur(function(){var e=t(this).val();e&&n.model.checkIsCaptchaRequired(e).done(function(e){e?(r.show(),s()):r.hide(),i=e,n.$el.triggerHandler("QucDOMUpdated")})}),n.$el.find(".quc-captcha-change").click(function(e){e.preventDefault(),s()}),n.model.on("invalid",o)})},getCurrentType:function(){return this.signInType||(this.signInType=this.model.isQuickSignInAvailable()?"quick":this.model.getSignInTypes()[0]),this.signInType},getTitle:function(){var n=this,r=n.model.getSignInTypes(),i=n.getCurrentType(),o;return i=="quick"||r.length<2?o=t("<span>").html(e.getConfig("signIn.panelTitle","\u6b22\u8fce\u767b\u5f55360")):(o=t("<p>").addClass("quc-sign-in-nav quc-sign-in-nav-c"+r.length),t.each(r,function(e,r){t("<a>").addClass(i==r?"quc-current":"").attr({href:"#","data-type":r}).html(s[r]||"\u5176\u4ed6\u65b9\u5f0f").click(function(e){e.preventDefault(),i!=r&&n.changeType(r)}).appendTo(o)})),o},show:function(n){this.reset(),this.$nav=this.getTitle(),this.changeType(this.getCurrentType());if(!n){var r=this.panel=new e.utils.Panel;r.setTitle(this.$nav),r.setContent(this.$el),this.model.trigger("beforeShow",this.$el[0]),r.show(),t(r).on("close",e.getConfig("signIn.panelCloseHandler",t.noop))}else this.model.trigger("beforeShow",this.$el[0]),t(n).addClass("quc-wrapper quc-page").empty().append(this.$el);this.model.trigger("afterShow",this.$el[0])},hide:function(){this.model.trigger("beforeHide",this.$el[0]),this.panel&&this.panel.hide(),this.model.trigger("afterHide",this.$el[0])}};e.ui.signIn={init:function(){u.init.apply(u,arguments)},changeType:function(e){u.changeType(e)},setOnSignUpCallback:function(e){u.onSignUp=e}}})(QHPass)