$(function(){if(!("placeholder" in document.createElement("input"))){$(".inp-text").each(function(){var b=$(this).attr("placeholder"),a=$(this).attr("type");if(a=="password"){if(!((this.value!=null)&&($.trim(this.value)!=""))){$(this).parent().append("<span class='ie-ph'>"+b+"</span>")}$(this).focus(function(){removeErr($(this).attr("id"));$(this).siblings(".ie-ph").hide()});$(this).blur(function(){if(this.value==""){$(this).siblings(".ie-ph").show()}if(l2){isUser(false)}else{loadLoginType(false)}});$(".inpl-wrap").on("click",".ie-ph",function(){$(this).siblings(".inp-text").focus()})}else{if(!((this.value!=null)&&($.trim(this.value)!=""))){$(this).val(b)}this.onfocus=function(){removeErr($(this).attr("id"));if(this.value===b){this.value="";this.style.color=""}};this.onblur=function(){if($(this).attr("id")=="username"){getUserTimes()}if(this.value===""){this.value=b;this.style.color="#999"}};this.style.color="#999"}})}else{$(".inp-text").each(function(){type=$(this).attr("type");if(type=="password"){$(this).bind("focus",function(){removeErr($(this).attr("id"))});$(this).bind("blur",function(){if(l2){isUser(false)}else{loadLoginType(false)}})}else{$(this).bind("focus",function(){removeErr($(this).attr("id"))});if($(this).attr("id")=="username"){$(this).bind("blur",function(){getUserTimes()})}}})}});var flag=false;$(document).ready(function(){$("#btnGetCode").unbind("click");if(l2){isUser(false)}else{loadLoginType(false)}var b=$("#verifyCodeError").val();var e=$("#messageCodeError").val();var a=$("#passwordError").val();var d=$("#closeBrowserError").val();var c=$("#noRoleError").val();if(d=="true"){tishiCloseBrowserError()}else{if(e=="true"){tishiMessageError()}else{if(b=="true"){tishiVerifyCodeError()}else{if(a=="true"){tishiPasswordCodeError()}else{if(c=="true"){tishiNoRoleError()}}}}}});function tishiCloseBrowserError(){$("#usernamenotice").html("\u8bf7\u5173\u95ed\u6d4f\u89c8\u5668\u91cd\u65b0\u767b\u5f55");$("#username").attr("class","inp-text err");$("#usernamenotice").css("display","block")}function tishiNoRoleError(){$("#usernamenotice").html("\u7528\u6237\u672a\u6388\u6743\u6216\u5df2\u7981\u7528\uff0c\u8bf7\u8054\u7cfb\u5e97\u94fa\u7ba1\u7406\u5458\u6388\u6743\u3002");$("#username").attr("class","inp-text err");$("#usernamenotice").css("display","block")}function tishiMessageError(){$("#messageVerifyCodenotice").html("\u624b\u673a\u5bc6\u7801\u6709\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");$("#messageVerifyCode").attr("class","inp-text err");$("#messageVerifyCodenotice").css("display","block")}function tishiVerifyCodeError(){$("#verifyCodenotice").html("\u9a8c\u8bc1\u7801\u6709\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");$("#verifyCode").attr("class","inp-text vcode err");$("#verifyCodenotice").css("display","block");$("#verifyCode").val("");$("#verifyCodeImg").attr("src","common/commonAction!generateRandomCode.do?t="+new Date().getTime())}function tishiPasswordCodeError(){$("#passwordnotice").html("\u7528\u6237\u540d\u6216\u5bc6\u7801\u4e0d\u6b63\u786e\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");$("#password").attr("class","inp-text err");$("#passwordnotice").css("display","block")}document.onkeydown=fnKeydown;function fnKeydown(){if(document.getElementById("BtnOk").disabled){return false}if(event.keyCode==13){execute("login")}}function removeErr(a){if(a=="username"||a=="password"||a=="messageVerifyCode"){$("#"+a).removeClass();$("#"+a).addClass("inp-text")}else{if(a=="verifyCode"){$("#"+a).removeClass();$("#"+a).addClass("inp-text vcode")}}$("#"+a+"notice").css("display","none")}function loadLoginType(isLogin){var username=$("#username").val();var usernamePlaceLoader=$("#username").attr("placeholder");removeErr("username");removeErr("password");removeErr("verifyCode");removeErr("messageVerifyCode");var passWord=$("#password").val();var passwordPlaceLoader=$("#password").attr("placeholder");if(username==usernamePlaceLoader||username.trim()==""||passWord==passwordPlaceLoader||passWord.trim()==""){$("#messageVerifyCode").val("");$("#verifyCode").val("");return}var _verifyCode=$("#verifyCode").val();var verifyCodePlaceLoader=$("#verifyCode").attr("placeholder");if(typeof(loginTimes)!="undefined"&&parseInt(loginTimes)>=3){if(isLogin){if(verifyCodePlaceLoader==_verifyCode||_verifyCode.trim()==""){$("#verifyCodenotice").html("\u9a8c\u8bc1\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");$("#verifyCodenotice").css("display","block");$("#verifyCode").attr("class","inp-text vcode err");return}}else{type=="verifyCode";flag=false;return}}$.post(path+"/common/commonAction!getUserLoginTimes.do?v="+new Date().getTime(),{username:username},function(jsonData){var data=eval("("+jsonData+")");loginTimes=parseInt(data.code);if(typeof(loginTimes)!="undefined"&&parseInt(loginTimes)>=3&&isLogin==false){if($("#verifyCodeContainer").is(":visible")==false){$("#verifyCodeContainer").css("display","block");$("#verifyCodeImg").attr("src",path+"/common/commonAction!generateRandomCode.do?t="+new Date().getTime())}else{type=="verifyCode";flag=false}return}if(typeof(_verifyCode)!="undefined"&&isLogin&&parseInt(loginTimes)>=3){if(verifyCodePlaceLoader==_verifyCode||_verifyCode.trim()==""){if($("#verifyCodeContainer").is(":visible")==false){$("#verifyCodeContainer").css("display","block")}$("#verifyCodenotice").html("\u9a8c\u8bc1\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");$("#verifyCodenotice").css("display","block");$("#verifyCode").attr("class","inp-text vcode err");return}}else{_verifyCode=""}var d=new Date().getTime();$.post(path+"/common/commonAction!getUserLoginType.do?v="+d,{username:username,password:passWord,verifyCode:_verifyCode},function(jsonData){var data=eval("("+jsonData+")");code=data.code;type=data.loginType;useVerifyCode=data.useVerifyCode;if(type=="noUser"){$("#passwordnotice").html("\u7528\u6237\u540d\u6216\u5bc6\u7801\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");$("#passwordnotice").css("display","block");$("#verifyCodeContainer").css("display","none");$("#pohonecodeContainer").css("display","none");$("#getPhonecodeContainer").css("display","none");$("#password").attr("class","inp-text err");$("#username").attr("class","inp-text err");if(code==1&&useVerifyCode=="true"){$("#verifyCodeContainer").css("display","block");$("#verifyCode").val("");$("#verifyCodeImg").attr("src",path+"/common/commonAction!generateRandomCode.do?t="+new Date().getTime())}flag=false;return}if(code==0){var mobileDisplay=data.mobileDisplay;if(useVerifyCode=="true"){$("#verifyCodeContainer").css("display","block")}else{$("#verifyCodeContainer").css("display","none")}if(type=="mobileLogin"&&flag==false){time=parseInt(data.messageLock);if(time>0){$("#btnGetCode").unbind("click");if(typeof(interval)!="undefined"){if(interval){clearInterval(interval)}}interval=setInterval("jiancecode()",1000)}else{$("#btnGetCode").bind("click",getCode)}$("#mobileDisplay").html("<b>\u6ce8\u518c\u624b\u673a\uff1a</b>"+mobileDisplay);$("#getPhonecodeContainer").css("display","block");$("#pohonecodeContainer").css("display","block");$("#messageVerifyCode").val("");flag=true;return}if(type=="mobileLogin"&&isLogin){var messageCode=$("#messageVerifyCode").val();var messageCodePlaceLoader=$("#messageVerifyCode").attr("placeholder");if(messageCode==messageCodePlaceLoader||messageCode.trim()==""){$("#messageVerifyCodenotice").html("\u624b\u673a\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");$("#messageVerifyCodenotice").css("display","block");$("#messageVerifyCode").attr("class","inp-text err");return}var _loginUrl=path+"/common/commonAction!loginWithVerifyMessage.action";$("#userForm").attr("action",_loginUrl);$("#userForm").submit()}}else{if(code==1){if(type=="verifyCodeNull"){$("#verifyCodenotice").html("\u9a8c\u8bc1\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");$("#verifyCodenotice").css("display","block");$("#verifyCode").attr("class","inp-text vcode err")}if(type=="verifyCodeError"){$("#verifyCodenotice").html("\u9a8c\u8bc1\u7801\u6709\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");$("#verifyCode").attr("class","inp-text vcode err");$("#verifyCodenotice").css("display","block");$("#verifyCode").val("");$("#verifyCodeImg").attr("src",path+"/common/commonAction!generateRandomCode.do?t="+new Date().getTime())}}else{if(code==2){if(useVerifyCode=="true"&&!isLogin){$("#verifyCodeContainer").css("display","block");$("#verifyCode").val("");$("#verifyCodeImg").attr("src",path+"/common/commonAction!generateRandomCode.do?t="+new Date().getTime());return}if(isLogin){var _loginUrl=path+"/common/commonAction!login.action";$("#userForm").attr("action",_loginUrl);$("#userForm").submit()}}}}})})}document.onkeydown=fnKeydown;function fnKeydown(){if(document.getElementById("BtnOk").disabled){return false}if(event.keyCode==13){doLogin()}}var type;var code;var useVerifyCode;var loginTimes;function doLogin(){var d=$("#username").val();var a=$("#password").val();var c=$("#username").attr("placeholder");var b=$("#password").attr("placeholder");if(d==c||d.trim()==""){$("#usernamenotice").html("\u7528\u6237\u540d\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");$("#usernamenotice").css("display","block");$("#username").attr("class","inp-text err");return}if(a==b||a.trim()==""){$("#passwordnotice").html("\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");$("#passwordnotice").css("display","block");$("#password").attr("class","inp-text err");return}if(l2){isUser(true)}else{loadLoginType(true)}}function getCode(){$("#btnGetCode").unbind("click");var a=new Date().getTime();$("#btnGetCode").addClass("noaction");var b=$("#username").val();$.post(path+"/common/commonAction!sendMessageVerficode.do?v="+a,{username:b},function(d){try{var c=d.split("-");if(c[0]=="true"){if(typeof(interval)!="undefined"){if(interval){clearInterval(interval)}}time=parseInt(c[1]);interval=setInterval("jiancecode()",1000)}else{$("#btnGetCode").bind("click",getCode)}}catch(f){alert("\u8bf7\u7a0d\u540e\u518d\u83b7\u53d6!")}})}function jiancecode(){var a=$("#btnGetCode").attr("class");if(time<=0){if(interval){clearInterval(interval)}if(a.indexOf("noaction")>-1){$("#btnGetCode").removeClass("noaction")}$("#btnGetCode").addClass("btn-vcode-m");$("#btnGetCode").html("\u83b7\u53d6\u9a8c\u8bc1\u7801");$("#btnGetCode").bind("click",getCode)}else{if(a.indexOf("noaction")<0){$("#btnGetCode").addClass("noaction")}$("#btnGetCode").html((--time)+"\u79d2\u540e\u91cd\u65b0\u53d6")}}function isUser(isLogin){var username=$("#username").val();var usernamePlaceLoader=$("#username").attr("placeholder");var passWord=$("#password").val();var passwordPlaceLoader=$("#password").attr("placeholder");removeErr("verifyCode");removeErr("username");removeErr("password");if(username==usernamePlaceLoader||username.trim()==""||passWord==passwordPlaceLoader||passWord.trim()==""){$("#messageVerifyCode").val("");$("#verifyCode").val("");return}var _verifyCode=$("#verifyCode").val();var verifyCodePlaceLoader=$("#verifyCode").attr("placeholder");if(typeof(loginTimes)!="undefined"&&parseInt(loginTimes)>=3){if(isLogin){if(verifyCodePlaceLoader==_verifyCode||_verifyCode.trim()==""){$("#verifyCodenotice").html("\u9a8c\u8bc1\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");$("#verifyCodenotice").css("display","block");$("#verifyCode").attr("class","inp-text vcode err");return}}else{type=="verifyCode";flag=false;return}}$.post(path+"/common/commonAction!getUserLoginTimes.do?v="+new Date().getTime(),{username:username},function(jsonData){var data=eval("("+jsonData+")");loginTimes=parseInt(data.code);if(typeof(loginTimes)!="undefined"&&parseInt(loginTimes)>=3&&isLogin==false){if($("#verifyCodeContainer").is(":visible")==false){$("#verifyCodeContainer").css("display","block");$("#verifyCodeImg").attr("src",path+"/common/commonAction!generateRandomCode.do?t="+new Date().getTime())}else{type=="verifyCode";flag=false}return}var _verifyCode=$("#verifyCode").val();if(typeof(_verifyCode)!="undefined"&&isLogin&&parseInt(loginTimes)>=3){if(verifyCodePlaceLoader==_verifyCode||_verifyCode.trim()==""){if($("#verifyCodeContainer").is(":visible")==false){$("#verifyCodeContainer").css("display","block")}$("#verifyCodenotice").html("\u9a8c\u8bc1\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");$("#verifyCodenotice").css("display","block");$("#verifyCode").attr("class","inp-text vcode err");return}}else{_verifyCode=""}var d=new Date().getTime();$.post(path+"/common/common2Action!isUser.do?v="+d,{username:username,password:passWord,verifyCode:_verifyCode},function(jsonData){var data=eval("("+jsonData+")");code=data.code;type=data.loginType;useVerifyCode=data.useVerifyCode;if(type=="noUser"){$("#passwordnotice").html("\u7528\u6237\u540d\u6216\u5bc6\u7801\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");$("#passwordnotice").css("display","block");$("#password").attr("class","inp-text err");$("#username").attr("class","inp-text err");if(parseInt(loginTimes)>=2){$("#verifyCodeContainer").css("display","block");$("#verifyCode").val("");$("#verifyCodeImg").attr("src",path+"/common/commonAction!generateRandomCode.do?t="+new Date().getTime())}flag=false;return}else{if(code==1){if(useVerifyCode=="true"){$("#verifyCodenotice").css("display","block");$("#verifyCode").attr("class","inp-text vcode err");$("#verifyCodeImg").attr("src",path+"/common/commonAction!generateRandomCode.do?t="+new Date().getTime())}if(type=="verifyCodeNull"){$("#verifyCodenotice").html("\u9a8c\u8bc1\u7801\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165")}if(type=="verifyCodeError"){$("#verifyCodenotice").html("\u9a8c\u8bc1\u7801\u6709\u8bef\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165");$("#verifyCode").val("")}}else{if(code==2){if(useVerifyCode=="true"&&!isLogin){$("#verifyCodenotice").css("display","block");$("#verifyCode").attr("class","inp-text vcode err");$("#verifyCodeImg").attr("src",path+"/common/commonAction!generateRandomCode.do?t="+new Date().getTime());return}if(isLogin){var _loginUrl=path+"/common/commonAction!login.action";$("#userForm").attr("action",_loginUrl);$("#userForm").submit()}}}}})})}function getUserTimes(){var username=$("#username").val();if(null==username||username.trim()==""){return}$.post(path+"/common/commonAction!getUserLoginTimes.do?v="+new Date().getTime(),{username:username},function(jsonData){var data=eval("("+jsonData+")");loginTimes=parseInt(data.code);if(loginTimes>=3){$("#verifyCodeContainer").css("display","block")}else{$("#verifyCodeContainer").css("display","none")}})};
